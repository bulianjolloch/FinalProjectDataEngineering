mode: standalone
replicas: 1

auth:
  existingSecret: minio
  rootUserSecretKey: root-user
  rootPasswordSecretKey: root-password

global:
  security:
    allowInsecureImages: true

persistence:
  enabled: true
  size: 10Gi
  storageClass: local-path
  accessModes:
    - ReadWriteOnce

image:
  registry: quay.io
  repository: minio/minio
  tag: RELEASE.2023-09-30T07-02-29Z
  pullPolicy: IfNotPresent

command:
  - minio
args:
  - server
  - /bitnami/minio/data
  - "--address=:9000"
  - "--console-address=:9001"

console:
  enabled: false

service:
  type: ClusterIP
  ports:
    api: 9000
    console: 9001

# Provisioning configuration for bucket notifications
provisioning:
  enabled: true
  buckets: []  # input-data already exists, so we don't recreate it
  policies: []
  
  # Configure the webhook endpoint for Argo Events
  config:
    - name: webhook_argo_events
      options:
        endpoint: "http://minio-input-eventsource-svc.argo-events.svc.cluster.local:12000/input-data"
        queue_dir: ""
        queue_limit: "0"
  
  # Configure bucket notifications to send events to the webhook
  bucketNotifications:
    - bucket: input-data
      config: webhook_argo_events
      events:
        - s3:ObjectCreated:Put
        - s3:ObjectCreated:Post
        - s3:ObjectCreated:Copy
      prefix: ""
      suffix: ""

ingress:
  enabled: true
  ingressClassName: nginx
  hostname: minio.group-unop.dski23a.timebertt.dev
  extraHosts:
    - name: console-minio.group-unop.dski23a.timebertt.dev
      path: /
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
  tls: true

resources:
  requests:
    memory: 512Mi
    cpu: 250m
  limits:
    memory: 1Gi
    cpu: 500m

metrics:
  serviceMonitor:
    enabled: true
    namespace: data-storage
    includeNode: true
    labels:
      release: monitoring

